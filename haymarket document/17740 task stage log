

////////

Started GET "/directory/search?utf8=%E2%9C%93&facet=true&site_name=rp.autocarpro.haymarket.kreatio.info&directory_listing_search%5Bname%5D=ELGI+Equipments+Ltd.&searchby=company&utf8=%E2%9C%93&facet=true&site_name=rp.autocarpro.haymarket.kreatio.info&directory_listing_search%5Bname%5D=ELGI+Equipments+Ltd.&directory_listing_search%5Bcategory%5D=&directory_listing_search%5Bcategory%5D=&directory_listing_search%5Bcountry_id%5D=461&directory_listing_search%5Bcounty_id%5D=33&directory_listing_search%5Bcity_ids%5D%5B%5D=&per_page=10" for 192.168.209.31 at 2017-01-12 12:46:52 +0530
  Processing by Wps::DirectoryController#directory_search as HTML
  Parameters: {"utf8"=>"✓", "facet"=>"true", "site_name"=>"rp.autocarpro.haymarket.kreatio.info", "directory_listing_search"=>{"name"=>"ELGI Equipments Ltd.", "category"=>"", "country_id"=>"461", "county_id"=>"33", "city_ids"=>[""]}, "searchby"=>"company", "per_page"=>"10"}
 ---- rem checking
 -- rem -- nil -- nil --- nil
============params=============={"utf8"=>"✓", "facet"=>"true", "site_name"=>"rp.autocarpro.haymarket.kreatio.info", "directory_listing_search"=>{"name"=>"ELGI Equipments Ltd.", "category"=>"", "country_id"=>"461", "county_id"=>"33", "city_ids"=>[""]}, "searchby"=>"company", "per_page"=>"10", "controller"=>"wps/directory", "action"=>"directory_search"}====================
========new_dir=========[]==========[]==============
======search================nameeeeee======
====search1====vpageproperties===={:menu_title=>nil}=======nameeeeee======
======search2===={:menu_title=>nil}====="directory_search"=======vvvvvvvvvv======
======page11================nameeeeee======
====page2====vpageproperties===={:menu_title=>nil}=======nameeeeee======
=====page3===={:menu_title=>nil}====="directory_search"=======vvvvvvvvvv======
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/directory/partials/_search_form.html.erb (655.2ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/directory/partials/_search_pagination_info.html.erb (3.8ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/directory/directory_listing_search_page.html.erb within /layouts/autocar_pro (788.2ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/layouts/_seo_keys.html.erb (1.9ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/layouts/_styles.html.erb (3.7ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/layouts/_open_graph.html.erb (0.7ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/advers/_google_analytics.html.erb (0.3ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/advers/_social_media_script.html.erb (0.3ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/advers/_header_script_for_ad.html.erb (2.2ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/advers/_header_ad_responsive.html.erb (0.3ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/layouts/_header_search.html.erb (1.1ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/layouts/_login_links.html.erb (3.1ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/advers/_vertical_page_pusher.html.erb (15.4ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/listing_pages/partials/comp/_fragment_description.html.erb (2.0ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/decoration/_decoration_yield.html.erb (0.3ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/advers/_page_peel_script.html.erb (17.2ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/listing_pages/partials/comp/_fragment_description.html.erb (1.2ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/decoration/_decoration_yield.html.erb (0.0ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/advers/_first_impression.html.erb (15.0ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/advers/_top_leaderboard.html.erb (1.4ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/advers/_header_leader_banner.html.erb (2.1ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/layouts/_menus.html.erb (56.9ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/advers/_header_top_leader.html.erb (1.3ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/layouts/_header.html.erb (116.0ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/listing_pages/partials/comp/_fragment_description.html.erb (1.3ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/decoration/_decoration_yield.html.erb (0.0ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/advers/_middle_banner.html.erb (17.2ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/advers/_footer_leader_banner.html.erb (1.3ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/listing_pages/partials/_subscribe_newsletter.html.erb (0.3ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/listing_pages/partials/comp/_fragment_description.html.erb (1.2ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/decoration/_decoration_yield.html.erb (0.1ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/advers/_adding_text_links.html.erb (14.5ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/layouts/_footer_small_device.html.erb (1.0ms)
=========2222222222222222222111v===============
===666666666======111111111111v===============
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/listing_pages/partials/_fragment_content.html.erb (1.8ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/decoration/_decoration_yield.html.erb (0.0ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/listing_pages/partials/_container.html.erb (19.1ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/layouts/_footer.html.erb (28.7ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/layouts/_javascripts.html.erb (146.1ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/authentication/_login_form.html.erb (1.9ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/authentication/_forget_password_form.html.erb (1.4ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/authentication/_registration_form.html.erb (17.9ms)
Completed 200 OK in 1389ms (Views: 1188.5ms | ActiveRecord: 146.3ms | Solr: 10.5ms)


Started GET "/verify-site-login" for 192.168.209.31 at 2017-01-12 12:46:56 +0530
  Processing by CommonController#verify_authentication as HTML
 ---- rem checking
 -- rem -- nil -- nil --- nil
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/layouts/_header_search.html.erb (257.3ms)
Rendered /home/ruby/CMS/Sites/autocar_pro_responsive/views/layouts/_login_links.html.erb (262.0ms)














































class Wps::DirectoryController < WpsController
  include SimpleCaptcha::ControllerHelpers
  def directory_search

     logger.info"============params==============#{params.inspect}===================="
    @selected_menu=@site.get_selected_menu(:others=>"Home")
    @page_properties={:menu_title=>@site.get_property("home_title")}
    ##if params[:directory_listing_search].blank?
    ##  params[:directory_listing]={:name=>params[:query]}
    ##end
 #   if @site.config.autonomy.directory_search == "true"
      params[:query] = params[:directory_listing_search][:name] if params[:directory_listing_search]
      params[:query] =" " if params[:query].blank?
      params[:sort] = (@site.get_property("directory_default_sort_filter")  || "Relevance") if params[:sort].blank?
      filters = Utility.directory_filter_mapping(params[:directory_listing_search])
     
     filters[:data_proxy] = [@site.data_proxy_id].flatten
     filters[:paid_status_type] = "paid"
     filters[:country_id] = params[:directory_listing_search][:country_id] if !params[:directory_listing_search].blank? and !params[:directory_listing_search][:country_id].blank?
     filters[:county_id] = params[:directory_listing_search][:county_id] if !params[:directory_listing_search].blank? and !params[:directory_listing_search][:county_id].blank?
     #filters[:city_names] = City.find_by_id(params[:directory_listing][:city].to_i).name


     if !params[:directory_listing_search].blank?
      if !params[:directory_listing_search][:main_category].blank?
        category = @site.directory_listing_categories.where("full_name = ?",params[:directory_listing_search][:main_category]).last.full_alias_name
        filters[:category_full_alias_names]  = @site.directory_listing_categories.where("full_alias_name ILIKE  ?","#{category}%").collect(&:full_alias_name)
        if !params[:directory_listing_search][:main_category].blank? and !params[:directory_listing_search][:sub_category].blank?
          category = @site.directory_listing_categories.where("full_name = ?",params[:directory_listing_search][:main_category]+" >> "+params[:directory_listing_search][:sub_category]).last.full_alias_name
          filters[:category_full_alias_names]  = @site.directory_listing_categories.where("full_alias_name ILIKE ?","#{category}%").collect(&:full_alias_name)
          if !params[:directory_listing_search][:main_category].blank? and !params[:directory_listing_search][:sub_category].blank? and !params[:directory_listing_search][:sub_child_category].blank?
            category = @site.directory_listing_categories.where("full_name = ?",params[:directory_listing_search][:main_category]+" >> "+params[:directory_listing_search][:sub_category]+" >> "+params[:directory_listing_search][:sub_child_category]).last.full_alias_name
            filters[:category_full_alias_names]  = @site.directory_listing_categories.where("full_alias_name ILIKE ?","#{category}%").collect(&:full_alias_name)
          end
        end
      end
    end
        params[:page] = 1  if params[:page].blank?
        params[:per_page] = 10 if params[:per_page].blank?  
      @directory_listings_paid=DirectoryListing.search_by_search_engine(params[:query],1,1000,params[:sort],filters,["category_names","service_names","location_names"])
     filters[:paid_status_type] = "free"
     @directory_listings_free=DirectoryListing.search_by_search_engine(params[:query],params[:page],params[:per_page],params[:sort],filters,["category_names","service_names","location_names"])
       logger.info"========new_dir=========#{@directory_listings_paid.results}==========#{@directory_listings_free.results}=============="
##logger.info"---directory search-----#{@directory_listings.results.count}----------#{@site.config.autonomy.directory_search}-----#{filters.inspect}-------------------#{params.inspect}----------------------"
  #  else
   #   @directory_listings = Service.search_by_search_engine(params[:directory_listing_search][:name], params[:page], params[:per_page], "Relevance", params,["categories_names"])
##logger.info"---Service search-----#{@directory_listings}----------#{@site.config.autonomy.directory_search}---------#{params.inspect}-------------------------------------"
  #  end
##logger.info"---Service search-----#{@directory_listings}----------#{@site.config.autonomy.directory_search}------------------------------------------"
    respond_to do |format|
      format.html do
        render :template=>@site.directory_listing_search_page,:layout=>@site.get_layout
      end
      format.rss do
        render :template=>"#{@site.directory_listing_search_page}-rss",:layout=>false
      end
    end
  end

Completed 200 OK in 306ms (Views: 269.9ms | ActiveRecord: 11.4ms | 
