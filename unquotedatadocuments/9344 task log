/////////////////////Started GET "/fund/73673" for 127.0.0.1 at 2017-01-28 10:53:42 +0530
Processing by Wps::UqFundsController#show_fund as HTML
  Parameters: {"fund_id"=>"73673"}
=========ssssssaaaaaaa======{:text=>"", :page=>1, :per_page=>20, :filters=>{:fund_filter_id=>[["73673"], "ary"]}, :sort=>"Relevance", :gt_filters=>{}, :lt_filters=>{}, :not_by_filters=>{}, :not_by_gt_filters=>{}, :not_by_lt_filters=>{}, :dy_sort=>{}, :facets=>[], :fields=>[], :include_models=>[Fund(id: integer, name: string, investor_group_component_id: integer, currency_id: integer, city_id: integer, target_size: string, vintage: integer, basic_fund_type_id: integer, fund_status: string, status_id: integer, fund_overview: text, new_investor_percent: string, existing_investor_percent: string, created_by: integer, updated_by: integer, created_at: datetime, updated_at: datetime, fund_check: boolean, proprietary_capital: boolean, fund_target_amount: string, investor_id: integer, country_id: integer, fund_target_amount_usd: string, data_proxy_id: integer, investor_group_id: integer, note_description: string, fund_target_amount_uk: float, fund_target_amount_us: float, fund_target_amount_euro: float, fund_target_amount_yen: float, fund_target_size_uk: float, fund_target_size_us: float, fund_target_size_euro: float, fund_target_size_yen: float, last_date: datetime, geo_name: string)]}
DDDDDDDDDDDDDDDDDDDDDDDDDDDDDddd1xxxxxxxxxxxxxfalse
WARNING: User#current is nil, are you including SentientController on your ApplicationController?
WARNING: User#current is nil, are you including SentientController on your ApplicationController?
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/funds/partials/profile/_recently_viewed_funds.html.erb (68.7ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/funds/partials/profile/_profile_top_link.html.erb (3.3ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/funds/partials/profile/_currency_selection.html.erb (2.5ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/funds/partials/profile/_basic_company_info.html.erb (9.3ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/funds/partials/profile/_company_information.html.erb (12.7ms)
===========fund_event============#<FundEvent id: 37409, fund_id: 73673, fund_event_type_id: 1, event_date: "2008-12-01", amount_closed: "0.0", target: "200.0", final_close: "false", created_by: nil, updated_by: nil, created_at: "2014-09-06 07:12:43", updated_at: "2014-09-06 07:12:43">========
===========fund_event============#<FundEvent id: 37410, fund_id: 73673, fund_event_type_id: 5, event_date: "2010-09-01", amount_closed: "88.0", target: "200.0", final_close: "true", created_by: nil, updated_by: nil, created_at: "2014-09-06 07:12:43", updated_at: "2014-09-06 07:12:43">========
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/funds/partials/profile/_fund_data.html.erb (110.6ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/funds/partials/profile/_fund_description.html.erb (0.9ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/funds/partials/profile/_investment_strategy.html.erb (20.8ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/funds/partials/profile/_lps_in_fund.html.erb (132.2ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/funds/partials/profile/_advisers_in_fund.html.erb (388.8ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/funds/partials/profile/_feedback_comments.html.erb (1.9ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/common/_personal_notes.html.erb (1.1ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/funds/fund_profile.html.erb within /layouts/post_login (1826.1ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/layouts/_seo_keys.html.erb (0.9ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/layouts/_stylesheets.html.erb (3.0ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/layouts/_head_scripts.html.erb (4.1ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/authentication/_header_logout.html.erb (1.0ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/listing_pages/partials/_post_login_menu.erb (27.2ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/layouts/_header.html.erb (35.2ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/listing_pages/partials/_post_login_menu.erb (6.3ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/layouts/_footer.html.erb (43.1ms)
  Rendered /home/ruby/Unquote_data/Sites/unquote_data_site/views/layouts/_javascript.html.erb (0.4ms)
Completed 200 OK in 2296ms (Views: 1835.8ms | ActiveRecord: 221.0ms | Solr: 25.2ms)


















def show_fund
    @main_menu = Menu.only_parent_menus.by_name("After Login").first
    @selected_menu = Menu.by_name("Funds").first
    #funds = Fund.text_search({ :text => "", :page => 1, :per_page => PER_PAGE, :filters => {:fund_filter_id => [[params[:fund_id]], "ary"], :show_on_site => [true]} }).raw_results
    funds = Fund.text_search({ :text => "", :page => 1, :per_page => PER_PAGE, :filters => {:fund_filter_id => [[params[:fund_id]], "ary"]} }).raw_results
    if funds.map(&:primary_key).include?(params[:fund_id])
       @fund = @site.funds.by_fund_id(params[:fund_id]).first
       @event_date = @fund.fund_events.collect(&:event_date).compact.sort.first.beginning_of_month if !@fund.fund_events.blank? && !@fund.fund_events.collect(&:event_date).compact.sort.first.blank?

      session[:currency] = params[:funds][:currency] if params[:funds] !=nil && params[:funds][:currency] !=nil

      SubscriberLog.create(:entity_type => "Fund", :entity_id => @fund.id, :subscriber_id => session[:user_id], :log_type => "profile")

      recent_fund = RecentView.by_subscriber(session[:user_id]).by_entity_type("Fund").order("created_at desc").limit(20)
      # recent_fund = RecentView.by_subscriber(session[:user_id]).by_entity_type("Fund").limit(20)
      if !recent_fund.collect(&:entity_type_id).include?(@fund.id)
        RecentView.create(:subscriber_id => session[:user_id],:entity_type => @fund.class.name, :entity_type_id => @fund.id)
      else
        f=recent_fund.where(entity_type_id: @fund.id)
        f.first.delete
        RecentView.create(:subscriber_id => session[:user_id],:entity_type => @fund.class.name, :entity_type_id => @fund.id)
      end
      @recent_viewed =  RecentView.by_subscriber(session[:user_id]).by_entity_type("Fund").order("created_at desc").limit(20)
      #@recent_viewed = RecentView.by_subscriber(session[:user_id]).by_entity_type("Fund").limit(20)
      @investment_preference = @fund.investment_preference
      @country_ids= @investment_preference.countries.pluck(:id) if @investment_preference.present?
      @continent_countries = ContinentCountry.where(country_id: @country_ids)
      if @continent_countries.present?
         @regions= Region.where(:id=> @continent_countries.pluck(:region_id))
         @sub_regions= SubRegion.where(:id=> @continent_countries.pluck(:sub_region_id))
      end
      if params[:search_id]
       @back_search = SavedSearch.find_by_id(params[:search_id])
      end
      @terms_conditions = @fund.terms_condition
      @fund_structure = @fund.fund_structure
      @fund_event = @fund.fund_events
      @fund_portifolios = @fund.deal_investments
      @fund_lps = @fund.lp_funds

       work_group_id = Subscriber.find(session[:user_id]).work_group_id
       @subscriber_note = SubscriberNote.by_work_group(work_group_id).by_entity_type(@fund.class.name).by_entity_id(@fund.id).first

                       render :template => "/funds/fund_profile", :layout => "/layouts/post_login"
    else
      render_404_after_login
    end
  end
                                                                                                                                       326,0-1       48%

